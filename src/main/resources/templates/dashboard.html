<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--  <meta charset="UTF-8">-->
<!--  <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--  <title>User Dashboard</title>-->
<!--  <link rel="stylesheet" href="../css/style.css">-->
<!--  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">-->
<!--  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>-->
<!--</head>-->
<!--<body>-->
<!--&lt;!&ndash; header and other content &ndash;&gt;-->

<!--<h1 class="text-center">User Dashboard</h1>-->
<!--<hr>-->
<!--<div class="container pagination-container">-->
<!--  <div class="row dashboard">-->
<!--    &lt;!&ndash; Initial watchlist card removed &ndash;&gt;-->
<!--  </div>-->
<!--</div>-->
<!--<button type="button" class="create-watchlist-button btn btn-primary">Create Watchlist</button>-->
<!--<script>-->
<!--  const maxCardsPerPage = 8; // Maximum number of cards per page-->
<!--  let currentPage = 1;-->

<!--  document.querySelector(".create-watchlist-button").addEventListener("click", function () {-->
<!--    const dashboardContainer = document.querySelector(".dashboard");-->
<!--    const totalCards = dashboardContainer.childElementCount;-->
<!--    const totalPages = Math.ceil(totalCards / maxCardsPerPage);-->

<!--    if (totalCards < maxCardsPerPage * currentPage) {-->
<!--      addWatchlistCard(dashboardContainer);-->
<!--    } else if (currentPage < totalPages) {-->
<!--      currentPage++;-->
<!--      updatePagination();-->
<!--    } else {-->
<!--      currentPage++;-->
<!--      createNewPage();-->
<!--      updatePagination();-->
<!--      addWatchlistCard(document.querySelector(".pagination-container").lastElementChild);-->
<!--    }-->
<!--  });-->

<!--  function addWatchlistCard(container) {-->
<!--    // Create the dashboard-card elements-->
<!--    const dashboardCard = document.createElement("div");-->
<!--    dashboardCard.classList.add("dashboard-card", "col-lg-3");-->

<!--    const cardTitle = document.createElement("div");-->
<!--    cardTitle.classList.add("dashboard-card-title");-->
<!--    cardTitle.textContent = "New Watchlist";-->

<!--    const cardContent = document.createElement("div");-->
<!--    cardContent.classList.add("dashboard-card-content");-->

<!--    const cardButton = document.createElement("button");-->
<!--    cardButton.classList.add("card-button", "btn", "btn-primary");-->
<!--    cardButton.textContent = "Add New Coin";-->

<!--    // Append the elements to the dashboard-card-->
<!--    dashboardCard.appendChild(cardTitle);-->
<!--    dashboardCard.appendChild(cardContent);-->
<!--    dashboardCard.appendChild(cardButton);-->

<!--    // Append the new dashboard-card to the container-->
<!--    container.appendChild(dashboardCard);-->
<!--  }-->

<!--  function updatePagination() {-->
<!--    const dashboardPages = document.querySelectorAll(".dashboard");-->
<!--    dashboardPages.forEach((page, index) => {-->
<!--      if (index + 1 === currentPage) {-->
<!--        page.style.display = "flex";-->
<!--      } else {-->
<!--        page.style.display = "none";-->
<!--      }-->
<!--    });-->
<!--  }-->

<!--  function createNewPage() {-->
<!--    const newPage = document.createElement("div");-->
<!--    newPage.classList.add("row", "dashboard");-->
<!--    newPage.style.display = "none";-->
<!--    document.querySelector(".pagination-container").appendChild(newPage);-->
<!--  }-->

<!--</script>-->
<!--</body>-->
<!--</html>-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Dashboard</title>
  <link rel="stylesheet" href="../css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</head>
<body>
<!-- header and other content -->

<h1 class="text-center">User Dashboard</h1>
<hr>
<div class="container pagination-container">
  <div class="row dashboard">
    <!-- Initial watchlist card removed -->
  </div>
</div>
<button type="button" class="create-watchlist-button btn btn-primary">Create Watchlist</button>

<!-- Add watchlist modal -->
<div class="modal fade" id="addWatchlistModal" tabindex="-1" aria-labelledby="addWatchlistModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addWatchlistModalLabel">Add Watchlist</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label for="watchlistTitle" class="form-label">Watchlist Title</label>
            <input type="text" class="form-control" id="watchlistTitle" placeholder="Enter watchlist title">
          </div>

<!--          <div class="mb-3">-->
<!--            <label for="cryptoCoinCount" class="form-label">Crypto Coin Count</label>-->
<!--            <input type="number" class="form-control" id="cryptoCoinCount" placeholder="Enter the number of crypto coins">-->
<!--          </div>-->
        </form>
        <div class=" mb-3 ">
          <input id="search" type="text"   oninput="if($('#search').val() !== null){searchQuery($('#search').val())} "class="form-control form-control-dark text-bg-dark" placeholder="Search..." aria-label="Search">
        </div>
        <div><ul id="searchResults"></ul></div>
      </div>
      <div>
        <h6>Added coins:</h6>
        <ul id="addedCoins"></ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="addWatchlistDoneButton">Done</button>
      </div>
    </div>
  </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
<script>
  const maxCardsPerPage = 8; // Maximum number of cards per page
  let currentPage = 1;

  // Event listener for create-watchlist-button
  document.querySelector(".create-watchlist-button").addEventListener("click", function () {
    const modalElement = document.getElementById("addWatchlistModal");
    const modalInstance = new bootstrap.Modal(modalElement);
    modalInstance.show();
  });

  // updatePagination function
  function updatePagination() {
    const dashboardPages = document.querySelectorAll(".dashboard");
    dashboardPages.forEach((page, index) => {
      if (index + 1 === currentPage) {
        page.style.display = "flex";
      } else {
        page.style.display = "none";
      }
    });
  }

  // createNewPage function
  function createNewPage() {
    const newPage = document.createElement("div");
    newPage.classList.add("row", "dashboard");
    newPage.style.display = "none";
    document.querySelector(".pagination-container").appendChild(newPage);
  }

  // Other code (maxCardsPerPage, currentPage, event listener for create-watchlist-button, updatePagination, createNewPage)

  document.getElementById("addWatchlistDoneButton").addEventListener("click", function () {
    const title = document.getElementById("watchlistTitle").value;
    const count = document.getElementById("cryptoCoinCount").value;
    const dashboardContainer = document.querySelector(".dashboard");
    addWatchlistCard(dashboardContainer, title, count);

    // Reset form and close the modal
    document.getElementById("watchlistTitle").value = "";
    document.getElementById("cryptoCoinCount").value = "";
    const modalElement = document.getElementById("addWatchlistModal");
    const modalInstance = bootstrap.Modal.getInstance(modalElement);
    modalInstance.hide();
  });

  function addWatchlistCard(container, title, count) {
    // Create the dashboard-card elements
    const dashboardCard = document.createElement("div");
    dashboardCard.classList.add("dashboard-card", "col-lg-3", "card", "border-primary", "mb-3");

    const cardHeader = document.createElement("h5");
    cardHeader.classList.add("card-header");
    cardHeader.textContent = title || "New Watchlist";

    const cardBody = document.createElement("div");
    cardBody.classList.add("card-body");

    const cryptoCoinCount = document.createElement("p");
    cryptoCoinCount.classList.add("card-text");
    cryptoCoinCount.textContent = "Crypto Coins: " + (count || "0");

    const cardButton = document.createElement("button");
    cardButton.classList.add("card-button", "btn", "btn-primary");
    cardButton.textContent = "Edit Watchlist";

    // Append the elements to the dashboard-card
    cardBody.appendChild(cryptoCoinCount);
    cardBody.appendChild(cardButton);
    dashboardCard.appendChild(cardHeader);
    dashboardCard.appendChild(cardBody);

    // Append the new dashboard-card to the container
    container.appendChild(dashboardCard);


  }
  const searchQuery = (input) => {
    $('#searchResults').empty();
    try {
      $.getJSON(`https://api.coingecko.com/api/v3/search?query=${input}`)
              .done(function (data) {
                let info = data.coins;
                $('#searchResults').append(`<span style="background:rgba(255,255,255,0.5);z-index: 12;position: relative;right: -96%;top: 21px;color:red;cursor:pointer;" onclick="$('#searchResults').empty()">X</span>`);
                info.forEach((coin) => {
                  let marketCap = coin.market_cap_rank;
                  if (marketCap == null) {
                    return "NA";
                  }
                  let searchContent = "";
                  searchContent +=
                          `<li><span>#${marketCap} </span><a href="${coin.id}"><img src="${coin.thumb}" alt="${coin.id}">${coin.symbol} ${coin.id}</a></li>`;
                  $('#searchResults').append(searchContent);
                });
              });
    } catch (error) {
      console.error("Error fetching data:", error);
    }
  };

  function debounce(func, wait) {
    let timeout;
    return function (...args) {
      const context = this;
      clearTimeout(timeout);
      timeout = setTimeout(() => {
        func.apply(context, args);
      }, wait);
    };
  }

  const debouncedFunction = debounce(searchQuery, 300);

  $('#search').on('input', function () {
    $('#searchResults').empty();
    debouncedFunction($(this).val());
  });

  let addedCoins = [];

  // Event listener for adding coins
  $('#searchResults').on('click', 'a', function (event) {
    event.preventDefault();

    const coinId = $(this).text().trim();
    const coinHref = $(this).attr('href');

    // Check if the coin is already added
    if (addedCoins.some(coin => coin.id === coinHref)) {
      alert('Coin already added to the watchlist.');
      return;
    }

    // Add the coin to the addedCoins array
    addedCoins.push({ id: coinHref, name: coinId });

    // Display the added coin in the "addedCoins" list
    $('#addedCoins').append(`<li data-id="${coinHref}">${coinId}</li>`);
  });

</script>

</body>
</html>


